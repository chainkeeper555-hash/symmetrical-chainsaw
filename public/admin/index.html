<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamerPulse Dashboard | Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-top: #07121a;
            --bg-bottom: #001017;
            --card-bg: #031016;
            --accent-cyan: #00E0FF;
            --accent-cyan-2: #72F4FF;
            --muted-white: #c7dfe6;
            --thumbnail-yellow: #ffd700;
            --thumbnail-green: #00ff66;
            --text-white: #ffffff;
            --neon-green: #00ff99;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
            color: var(--muted-white);
            min-height: 100vh;
            font-size: clamp(12px, 3vw, 14px);
            overflow-x: hidden;
        }

        body::-webkit-scrollbar, html { scrollbar-width: none; }
        body { -ms-overflow-style: none; }

        .bg-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle, transparent 0%, var(--bg-top) 90%),
                repeating-linear-gradient(45deg, rgba(3,22,25,0.18) 0px, rgba(3,22,25,0.18) 2px, transparent 2px, transparent 6px),
                repeating-linear-gradient(-45deg, rgba(3,22,25,0.18) 0px, rgba(3,22,25,0.18) 2px, transparent 2px, transparent 6px);
            filter: blur(4px);
            z-index: -1;
            opacity: 0.5;
        }

        .sidebar {
            background: var(--card-bg);
            transition: all 0.3s ease;
            width: 280px;
            border-right: 1px solid var(--accent-cyan);
        }

        .sidebar-collapsed { width: 80px; }
        .sidebar-collapsed .nav-text { display: none; }
        .content-expanded { margin-left: 80px; }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--accent-cyan);
            backdrop-filter: blur(6px);
            transition: all 0.25s cubic-bezier(.2,.9,.3,1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,224,255,0.28);
        }

        .notification-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .cta-button {
            background: rgba(167, 236, 255, 1);
            color: #021d22;
            border-radius: 15px;
            border: 1px solid var(--accent-cyan);
            padding: 12px 24px;
            font-weight: 900;
            font-size: clamp(10px, 2.5vw, 12px);
            transition: all 0.18s cubic-bezier(.2,.9,.3,1);
        }

        .cta-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,224,255,0.48);
        }

        .chart-container {
            background: rgba(10, 30, 40, 0.5);
            border: 1px solid var(--accent-cyan);
            backdrop-filter: blur(6px);
        }

        .modal {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar shadow-lg z-10 flex-shrink-0" id="sidebar">
            <div class="flex flex-col h-full">
                <div class="flex items-center justify-between p-4 border-b border-[var(--accent-cyan)]">
                    <div class="flex items-center">
                        <img src="http://static.photos/technology/200x200/42" alt="Logo" class="h-10 w-10 rounded-full">
                        <span class="ml-3 text-xl font-bold text-[var(--accent-cyan)] nav-text">StreamerPulse</span>
                    </div>
                    <button id="sidebar-toggle" class="text-[var(--muted-white)] hover:text-[var(--accent-cyan)]">
                        <i data-feather="chevron-left" class="w-5 h-5"></i>
                    </button>
                </div>
                <nav class="flex-1 overflow-y-auto mt-4">
                    <div class="px-4 space-y-1">
                        <a href="#dashboard" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">
                            <i data-feather="home" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Dashboard</span>
                        </a>
                        <a href="#contacts" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="message-square" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Contacts</span>
                            <span id="contact-count" class="ml-auto px-2 py-0.5 text-xs font-medium rounded-full bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">0</span>
                        </a>
                        <a href="#news" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="file-text" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">News</span>
                        </a>
                        <a href="#shorts" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="video" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Shorts</span>
                        </a>
                        <a href="#videos" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="film" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Videos</span>
                        </a>
                        <a href="#giveaways" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="award" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Giveaways</span>
                            <span id="entry-count" class="ml-auto notification-dot bg-[var(--thumbnail-yellow)] h-2 w-2 rounded-full"></span>
                        </a>
                        <a href="#leaderboard" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="award" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Leaderboard</span>
                        </a>
                        <a href="#visitors" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="users" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Visitors</span>
                        </a>
                        <a href="#link-clicks" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="link" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Link Clicks</span>
                        </a>
                        <a href="#schedule" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">
                            <i data-feather="calendar" class="w-5 h-5 text-[var(--text-white)]"></i>
                            <span class="ml-3 nav-text">Schedule</span>
                        </a>
                    </div>
                </nav>
                <div class="p-4 border-t border-[var(--accent-cyan)]">
                    <div class="flex items-center">
                        <img src="http://static.photos/people/200x200/42" alt="User" class="h-10 w-10 rounded-full">
                        <div class="ml-3 nav-text">
                            <p class="text-sm font-medium text-[var(--text-white)]">SH4NER</p>
                            <p class="text-xs text-[var(--muted-white)]">Partner Streamer</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto content-expanded" id="main-content">
            <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                <!-- Stats Grid -->
                <div id="dashboard" class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
                    <div class="stat-card rounded-lg">
                        <div class="px-4 py-5 sm:p-6 flex items-center">
                            <div class="flex-shrink-0 bg-[var(--accent-cyan)] rounded-md p-3">
                                <i data-feather="message-square" class="h-6 w-6 text-[var(--text-white)]"></i>
                            </div>
                            <div class="ml-5">
                                <dt class="text-sm font-medium text-[var(--muted-white)]">Total Contacts</dt>
                                <dd class="flex items-baseline">
                                    <div id="total-contacts" class="text-2xl font-semibold text-[var(--text-white)]">0</div>
                                </dd>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card rounded-lg">
                        <div class="px-4 py-5 sm:p-6 flex items-center">
                            <div class="flex-shrink-0 bg-[var(--thumbnail-green)] rounded-md p-3">
                                <i data-feather="award" class="h-6 w-6 text-[var(--text-white)]"></i>
                            </div>
                            <div class="ml-5">
                                <dt class="text-sm font-medium text-[var(--muted-white)]">Giveaway Entries</dt>
                                <dd class="flex items-baseline">
                                    <div id="total-entries" class="text-2xl font-semibold text-[var(--text-white)]">0</div>
                                </dd>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card rounded-lg">
                        <div class="px-4 py-5 sm:p-6 flex items-center">
                            <div class="flex-shrink-0 bg-[var(--thumbnail-yellow)] rounded-md p-3">
                                <i data-feather="users" class="h-6 w-6 text-[var(--text-white)]"></i>
                            </div>
                            <div class="ml-5">
                                <dt class="text-sm font-medium text-[var(--muted-white)]">Total Visitors</dt>
                                <dd class="flex items-baseline">
                                    <div id="total-visitors" class="text-2xl font-semibold text-[var(--text-white)]">0</div>
                                </dd>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card rounded-lg">
                        <div class="px-4 py-5 sm:p-6 flex items-center">
                            <div class="flex-shrink-0 bg-[var(--accent-cyan-2)] rounded-md p-3">
                                <i data-feather="link" class="h-6 w-6 text-[var(--text-white)]"></i>
                            </div>
                            <div class="ml-5">
                                <dt class="text-sm font-medium text-[var(--muted-white)]">Total Link Clicks</dt>
                                <dd class="flex items-baseline">
                                    <div id="total-link-clicks" class="text-2xl font-semibold text-[var(--text-white)]">0</div>
                                </dd>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <div class="chart-container p-6 rounded-lg lg:col-span-2">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-medium text-[var(--text-white)]">Visitor Activity (Last 14 Days)</h2>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 text-sm rounded-md bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">All</button>
                                <button class="px-3 py-1 text-sm rounded-md text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">Unique</button>
                            </div>
                        </div>
                        <div class="h-80">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container p-6 rounded-lg">
                        <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Giveaway Entries</h2>
                        <div class="h-80">
                            <canvas id="subscribersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)] lg:col-span-2">
                        <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Recent Activity</h2>
                        <div id="recent-activity" class="space-y-4">
                            <div class="flex items-start">
                                <div class="flex-1">
                                    <p class="text-sm text-[var(--muted-white)]">No recent activity</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button class="w-full cta-button">View All Activity</button>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Schedule -->
                    <div id="schedule" class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                        <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Upcoming Schedule</h2>
                        <div id="schedule-items" class="space-y-4">
                            <p class="text-sm text-[var(--muted-white)]">No upcoming events</p>
                        </div>
                    </div>
                </div>

                <!-- News Section -->
                <div id="news" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">News</h2>
                    <div id="news-items" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <p class="text-sm text-[var(--muted-white)]">No news available</p>
                    </div>
                </div>

                <!-- Shorts Section -->
                <div id="shorts" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Shorts</h2>
                    <div id="shorts-items" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <p class="text-sm text-[var(--muted-white)]">No shorts available</p>
                    </div>
                </div>

                <!-- Videos Section -->
                <div id="videos" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Videos</h2>
                    <div id="videos-items" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <p class="text-sm text-[var(--muted-white)]">No videos available</p>
                    </div>
                </div>

                <!-- Giveaways Section -->
                <div id="giveaways" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Giveaways</h2>
                    <div id="giveaway-items" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <p class="text-sm text-[var(--muted-white)]">No giveaways available</p>
                    </div>
                </div>

                <!-- Visitors Section -->
                <div id="visitors" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Visitors</h2>
                    <div id="visitor-items" class="space-y-4">
                        <p class="text-sm text-[var(--muted-white)]">No visitor data available</p>
                    </div>
                </div>

                <!-- Link Clicks Section -->
                <div id="link-clicks" class="mt-8 bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
                    <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Link Clicks</h2>
                    <div id="link-click-items" class="space-y-4">
                        <p class="text-sm text-[var(--muted-white)]">No link click data available</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-8 grid grid-cols-2 gap-4 sm:grid-cols-4">
                    <button id="open-contact-form" class="flex flex-col items-center p-4 bg-[var(--card-bg)] rounded-lg border border-[var(--accent-cyan)] hover:bg-[rgba(0,224,255,0.1)]">
                        <div class="p-3 rounded-full bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">
                            <i data-feather="message-square" class="h-6 w-6"></i>
                        </div>
                        <span class="mt-2 text-sm font-medium text-[var(--text-white)]">Submit Contact</span>
                    </button>
                    <button id="open-giveaway-form" class="flex flex-col items-center p-4 bg-[var(--card-bg)] rounded-lg border border-[var(--accent-cyan)] hover:bg-[rgba(0,224,255,0.1)]">
                        <div class="p-3 rounded-full bg-[rgba(0,255,102,0.2)] text-[var(--thumbnail-green)]">
                            <i data-feather="award" class="h-6 w-6"></i>
                        </div>
                        <span class="mt-2 text-sm font-medium text-[var(--text-white)]">Enter Giveaway</span>
                    </button>
                </div>

                <!-- Contact Form Modal -->
                <div id="contact-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
                    <div class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)] w-full max-w-md">
                        <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Submit Contact</h2>
                        <div id="contact-error" class="hidden text-sm text-red-600 mb-4"></div>
                        <div class="space-y-4">
                            <input id="contact-firstName" type="text" placeholder="First Name" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <input id="contact-lastName" type="text" placeholder="Last Name" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <input id="contact-email" type="email" placeholder="Email" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <input id="contact-phone" type="text" placeholder="Phone (Optional)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <textarea id="contact-message" placeholder="Message" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]" rows="4"></textarea>
                            <div class="flex justify-end space-x-2">
                                <button id="contact-cancel" class="px-4 py-2 text-[var(--muted-white)] hover:text-[var(--accent-cyan)]">Cancel</button>
                                <button id="contact-submit" class="cta-button">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Giveaway Entry Modal -->
                <div id="giveaway-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
                    <div class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)] w-full max-w-md">
                        <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Enter Giveaway</h2>
                        <div id="giveaway-error" class="hidden text-sm text-red-600 mb-4"></div>
                        <div class="space-y-4">
                            <input id="giveaway-email" type="email" placeholder="Email" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <input id="giveaway-depositAmount" type="number" placeholder="Deposit Amount ($)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <input id="giveaway-prize" type="text" placeholder="Prize (Optional)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                            <div class="flex justify-end space-x-2">
                                <button id="giveaway-cancel" class="px-4 py-2 text-[var(--muted-white)] hover:text-[var(--accent-cyan)]">Cancel</button>
                                <button id="giveaway-submit" class="cta-button">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        feather.replace();

        // Sidebar toggle
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('content-expanded');
            const icon = this.querySelector('i');
            icon.setAttribute('data-feather', sidebar.classList.contains('sidebar-collapsed') ? 'chevron-right' : 'chevron-left');
            feather.replace();
        });

        // Track visitor on page load
        async function trackVisitor() {
            try {
                await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackVisitor', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId: Date.now().toString() }) // Placeholder for unique identifier
                });
            } catch (err) {
                console.error('Error tracking visitor:', err);
            }
        }

        // Fetch and display stats
        async function fetchStats() {
            try {
                const [contacts, entries, visitors, linkClicks] = await Promise.all([
                    fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getContacts').then(res => res.json()),
                    fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getGiveawayEntries').then(res => res.json()),
                    fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackVisitor').then(res => res.json()),
                    fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackLinkClick').then(res => res.json())
                ]);
                document.getElementById('total-contacts').textContent = contacts.length;
                document.getElementById('total-entries').textContent = entries.length;
                document.getElementById('total-visitors').textContent = visitors.length;
                document.getElementById('total-link-clicks').textContent = linkClicks.length;
                document.getElementById('contact-count').textContent = contacts.length;
                document.getElementById('entry-count').classList.toggle('hidden', entries.length === 0);
            } catch (err) {
                console.error('Error fetching stats:', err);
            }
        }

        // Fetch and display charts
        async function fetchChartData() {
            try {
                const contacts = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getContacts').then(res => res.json());
                const entries = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getGiveawayEntries').then(res => res.json());
                const visitors = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackVisitor').then(res => res.json());

                // Process visitor activity (last 14 days)
                const today = new Date();
                const labels = Array.from({ length: 14 }, (_, i) => {
                    const date = new Date(today);
                    date.setDate(today.getDate() - (13 - i));
                    return `Day ${i + 1}`;
                });
                const visitorCounts = Array(14).fill(0);
                const uniqueVisitors = new Set();
                const uniqueCounts = Array(14).fill(0);

                visitors.forEach(visitor => {
                    const visitedAt = new Date(visitor.visitedAt);
                    const diffDays = Math.floor((today - visitedAt) / (1000 * 60 * 60 * 24));
                    if (diffDays >= 0 && diffDays < 14) {
                        visitorCounts[13 - diffDays]++;
                        uniqueVisitors.add(visitor.sessionId);
                        uniqueCounts[13 - diffDays] = uniqueVisitors.size;
                    }
                });

                const mainCtx = document.getElementById('mainChart').getContext('2d');
                new Chart(mainCtx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            {
                                label: 'Visitors',
                                data: visitorCounts,
                                borderColor: '#00b7eb',
                                backgroundColor: 'rgba(0,183,235,0.2)',
                                borderWidth: 4,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Unique Visitors',
                                data: uniqueCounts,
                                borderColor: '#ffff00',
                                backgroundColor: 'rgba(255,255,0,0.2)',
                                borderWidth: 4,
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top', 
                                labels: { 
                                    color: '#ffffff',
                                    font: { size: 18, weight: 'bold' }
                                } 
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'var(--accent-cyan)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                grid: { color: 'rgba(199,223,230,0.2)' }, 
                                ticks: { 
                                    color: '#ffffff',
                                    font: { size: 16, weight: 'bold' }
                                } 
                            },
                            x: { 
                                grid: { display: false }, 
                                ticks: { 
                                    color: '#ffffff',
                                    font: { size: 16, weight: 'bold' }
                                } 
                            }
                        },
                        backgroundColor: 'rgba(10,30,40,0.5)'
                    }
                });

                // Process giveaway entries (monthly)
                const entryCounts = Array(12).fill(0);
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                entries.forEach(entry => {
                    const enteredAt = new Date(entry.enteredAt);
                    const month = enteredAt.getMonth();
                    entryCounts[month]++;
                });

                const subsCtx = document.getElementById('subscribersChart').getContext('2d');
                new Chart(subsCtx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Giveaway Entries',
                                data: entryCounts,
                                backgroundColor: 'rgba(0,183,235,0.9)',
                                borderColor: '#00b7eb',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top', 
                                labels: { 
                                    color: '#ffffff',
                                    font: { size: 18, weight: 'bold' }
                                } 
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'var(--accent-cyan)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                grid: { color: 'rgba(199,223,230,0.2)' }, 
                                ticks: { 
                                    color: '#ffffff',
                                    font: { size: 16, weight: 'bold' }
                                } 
                            },
                            x: { 
                                grid: { display: false }, 
                                ticks: { 
                                    color: '#ffffff',
                                    font: { size: 16, weight: 'bold' }
                                } 
                            }
                        },
                        backgroundColor: 'rgba(10,30,40,0.5)'
                    }
                });
            } catch (err) {
                console.error('Error fetching chart data:', err);
            }
        }

        // Fetch and display recent activity
        async function fetchRecentActivity() {
            try {
                const entries = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getGiveawayEntries').then(res => res.json());
                const activityContainer = document.getElementById('recent-activity');
                activityContainer.innerHTML = entries.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No recent activity</p>' :
                    entries.slice(0, 3).map(entry => `
                        <div class="flex items-start">
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <p class="text-sm font-medium text-[var(--text-white)]">${entry.email}</p>
                                    <span class="text-xs text-[var(--muted-white)]">${new Date(entry.enteredAt).toLocaleString()}</span>
                                </div>
                                <p class="text-sm text-[var(--muted-white)]">Entered giveaway for ${entry.prize || 'Unknown'}</p>
                                <div class="mt-1 flex items-center text-xs text-[var(--muted-white)]">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">
                                        <i data-feather="award" class="h-3 w-3 mr-1"></i> Giveaway Entry
                                    </span>
                                </div>
                            </div>
                        </div>
                    `).join('') + '<div class="mt-4"><button class="w-full cta-button">View All Activity</button></div>';
                feather.replace();
            } catch (err) {
                console.error('Error fetching recent activity:', err);
            }
        }

        // Fetch and display schedule
        async function fetchSchedule() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getSchedule').then(res => res.json());
                const scheduleContainer = document.getElementById('schedule-items');
                scheduleContainer.innerHTML = response.schedule.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No upcoming events</p>' :
                    response.schedule.slice(0, 3).map(item => `
                        <div class="border-l-4 border-[var(--accent-cyan)] pl-4 py-2">
                            <div class="flex items-center justify-between">
                                <p class="text-sm font-medium text-[var(--text-white)]">${item.title || 'Untitled'}</p>
                                <span class="text-xs text-[var(--muted-white)]">${new Date(item.date).toLocaleString()}</span>
                            </div>
                            <p class="text-sm text-[var(--muted-white)] mt-1">${item.description || 'No description'}</p>
                        </div>
                    `).join('') + '<div class="mt-4"><button class="w-full cta-button"><i data-feather="plus" class="h-4 w-4 mr-2"></i> Schedule New Event</button></div>';
                feather.replace();
            } catch (err) {
                console.error('Error fetching schedule:', err);
            }
        }

        // Fetch and display news
        async function fetchNews() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getNews').then(res => res.json());
                const newsContainer = document.getElementById('news-items');
                newsContainer.innerHTML = response.news.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No news available</p>' :
                    response.news.slice(0, 4).map(item => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.title || 'Untitled'}</p>
                            <p class="text-sm text-[var(--muted-white)] mt-1">${item.content || 'No content'}</p>
                            <span class="text-xs text-[var(--muted-white)]">${new Date(item.createdAt).toLocaleString()}</span>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching news:', err);
            }
        }

        // Fetch and display shorts
        async function fetchShorts() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getShorts').then(res => res.json());
                const shortsContainer = document.getElementById('shorts-items');
                shortsContainer.innerHTML = response.shorts.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No shorts available</p>' :
                    response.shorts.slice(0, 4).map(item => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.title || 'Untitled'}</p>
                            <p class="text-sm text-[var(--muted-white)] mt-1">${item.description || 'No description'}</p>
                            <span class="text-xs text-[var(--muted-white)]">${new Date(item.createdAt).toLocaleString()}</span>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching shorts:', err);
            }
        }

        // Fetch and display videos
        async function fetchVideos() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getVideos').then(res => res.json());
                const videosContainer = document.getElementById('videos-items');
                videosContainer.innerHTML = response.videos.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No videos available</p>' :
                    response.videos.slice(0, 4).map(item => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.title || 'Untitled'}</p>
                            <p class="text-sm text-[var(--muted-white)] mt-1">${item.description || 'No description'}</p>
                            <span class="text-xs text-[var(--muted-white)]">${new Date(item.createdAt).toLocaleString()}</span>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching videos:', err);
            }
        }

        // Fetch and display giveaways
        async function fetchGiveaways() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/getGiveawayContent').then(res => res.json());
                const giveawayContainer = document.getElementById('giveaway-items');
                giveawayContainer.innerHTML = response.items.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No giveaways available</p>' :
                    response.items.map(item => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.title || 'Untitled'}</p>
                            <p class="text-sm text-[var(--muted-white)] mt-1">${item.description || 'No description'}</p>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching giveaways:', err);
            }
        }

        // Fetch and display visitors
        async function fetchVisitors() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackVisitor').then(res => res.json());
                const visitorContainer = document.getElementById('visitor-items');
                visitorContainer.innerHTML = response.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No visitor data available</p>' :
                    response.slice(0, 5).map(item => `
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.sessionId || 'Unknown'}</p>
                            <p class="text-sm text-[var(--muted-white)]">${new Date(item.visitedAt).toLocaleString()}</p>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching visitors:', err);
            }
        }

        // Fetch and display link clicks
        async function fetchLinkClicks() {
            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/trackLinkClick').then(res => res.json());
                const linkClickContainer = document.getElementById('link-click-items');
                linkClickContainer.innerHTML = response.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No link click data available</p>' :
                    response.slice(0, 5).map(item => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md">
                            <p class="text-sm font-medium text-[var(--text-white)]">${item.url || 'Unknown'}</p>
                            <p class="text-sm text-[var(--muted-white)] mt-1">Clicked at ${new Date(item.clickedAt).toLocaleString()}</p>
                        </div>
                    `).join('');
            } catch (err) {
                console.error('Error fetching link clicks:', err);
            }
        }

        // Contact form handling
        document.getElementById('open-contact-form').addEventListener('click', () => {
            document.getElementById('contact-modal').classList.remove('hidden');
        });
        document.getElementById('contact-cancel').addEventListener('click', () => {
            document.getElementById('contact-modal').classList.add('hidden');
            document.getElementById('contact-error').classList.add('hidden');
        });
        document.getElementById('contact-submit').addEventListener('click', async () => {
            const firstName = document.getElementById('contact-firstName').value;
            const lastName = document.getElementById('contact-lastName').value;
            const email = document.getElementById('contact-email').value;
            const phone = document.getElementById('contact-phone').value;
            const message = document.getElementById('contact-message').value;
            const errorDiv = document.getElementById('contact-error');

            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/submitContact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ firstName, lastName, email, phone, message })
                });
                const result = await response.json();
                if (response.ok) {
                    alert('Message sent successfully!');
                    document.getElementById('contact-modal').classList.add('hidden');
                    fetchStats();
                    fetchRecentActivity();
                    fetchChartData();
                } else {
                    errorDiv.textContent = result.errors.map(e => e.msg).join(', ');
                    errorDiv.classList.remove('hidden');
                }
            } catch (err) {
                errorDiv.textContent = 'Failed to send message';
                errorDiv.classList.remove('hidden');
            }
        });

        // Giveaway form handling
        document.getElementById('open-giveaway-form').addEventListener('click', () => {
            document.getElementById('giveaway-modal').classList.remove('hidden');
        });
        document.getElementById('giveaway-cancel').addEventListener('click', () => {
            document.getElementById('giveaway-modal').classList.add('hidden');
            document.getElementById('giveaway-error').classList.add('hidden');
        });
        document.getElementById('giveaway-submit').addEventListener('click', async () => {
            const email = document.getElementById('giveaway-email').value;
            const depositAmount = parseFloat(document.getElementById('giveaway-depositAmount').value);
            const prize = document.getElementById('giveaway-prize').value;
            const errorDiv = document.getElementById('giveaway-error');

            try {
                const response = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/submitGiveawayEntry', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, depositAmount, prize })
                });
                const result = await response.json();
                if (response.ok) {
                    alert('Entry submitted! Good luck!');
                    document.getElementById('giveaway-modal').classList.add('hidden');
                    fetchStats();
                    fetchRecentActivity();
                    fetchChartData();
                } else {
                    errorDiv.textContent = result.errors.map(e => e.msg).join(', ');
                    errorDiv.classList.remove('hidden');
                }
            } catch (err) {
                errorDiv.textContent = 'Invalid entry';
                errorDiv.classList.remove('hidden');
            }
        });

        // Initialize data
        document.addEventListener('DOMContentLoaded', () => {
            trackVisitor();
            fetchStats();
            fetchChartData();
            fetchRecentActivity();
            fetchSchedule();
            fetchNews();
            fetchShorts();
            fetchVideos();
            fetchGiveaways();
            fetchVisitors();
            fetchLinkClicks();
        });
    </script>
</body>
</html>