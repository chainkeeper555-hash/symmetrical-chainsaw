<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-top: #07121a;
            --bg-bottom: #001017;
            --card-bg: #031016;
            --accent-cyan: #00E0FF;
            --accent-cyan-2: #72F4FF;
            --muted-white: #c7dfe6;
            --thumbnail-yellow: #ffd700;
            --thumbnail-green: #00ff66;
            --text-white: #ffffff;
            --neon-green: #00ff99;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--card-bg);
            color: var(--muted-white);
            min-height: 100vh;
            font-size: clamp(12px, 3vw, 14px);
            overflow-x: hidden;
        }

        .cta-button {
            background: rgba(167, 236, 255, 1);
            color: #021d22;
            border-radius: 15px;
            border: 1px solid var(--accent-cyan);
            padding: 12px 24px;
            font-weight: 900;
            font-size: clamp(10px, 2.5vw, 12px);
            transition: all 0.18s cubic-bezier(.2,.9,.3,1);
        }

        .cta-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,224,255,0.48);
        }

        .modal {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        <div id="leaderboard" class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)]">
            <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Leaderboard</h2>
            <div class="flex space-x-2 mb-4">
                <button id="period-daily" class="px-3 py-1 text-sm rounded-md bg-[rgba(0,224,255,0.2)] text-[var(--accent-cyan)]">Daily</button>
                <button id="period-monthly" class="px-3 py-1 text-sm rounded-md text-[var(--muted-white)] hover:bg-[rgba(0,224,255,0.1)]">Monthly</button>
            </div>
            <div id="leaderboard-items" class="space-y-4">
                <p class="text-sm text-[var(--muted-white)]">No leaderboard data available</p>
            </div>
            <div class="mt-4">
                <button id="open-leaderboard-form" class="w-full cta-button">Add Leaderboard Entry</button>
            </div>
        </div>

        <!-- Leaderboard Entry Form -->
        <div id="leaderboard-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
            <div class="bg-[var(--card-bg)] p-6 rounded-lg border border-[var(--accent-cyan)] w-full max-w-md">
                <h2 class="text-lg font-medium text-[var(--text-white)] mb-4">Add Leaderboard Entry</h2>
                <div id="leaderboard-error" class="hidden text-sm text-red-600 mb-4"></div>
                <div class="space-y-4">
                    <input id="leaderboard-username" type="text" placeholder="Username" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                    <input id="leaderboard-userHandle" type="text" placeholder="User Handle (e.g., @jwkxd)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                    <input id="leaderboard-betAmount" type="number" placeholder="Bet Amount ($)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                    <input id="leaderboard-multiplier" type="number" step="0.1" placeholder="Multiplier (e.g., 2.5)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                    <input id="leaderboard-profit" type="number" placeholder="Profit ($)" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                    <select id="leaderboard-period" class="w-full px-3 py-2 bg-[var(--card-bg)] border border-[var(--accent-cyan)] rounded-md text-[var(--text-white)]">
                        <option value="daily">Daily</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <div class="flex justify-end space-x-2">
                        <button id="leaderboard-cancel" class="px-4 py-2 text-[var(--muted-white)] hover:text-[var(--accent-cyan)]">Cancel</button>
                        <button id="leaderboard-submit" class="cta-button">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        feather.replace();

        async function fetchLeaderboard(period = 'daily') {
            try {
                const response = await fetch(`https://symmetrical-chainsaw-otqn.onrender.com/api/leaderboard?period=${period}`);
                if (!response.ok) throw new Error(`Leaderboard API failed: ${response.status}`);
                const entries = await response.json();
                const leaderboardContainer = document.getElementById('leaderboard-items');
                leaderboardContainer.innerHTML = entries.length === 0 ? 
                    '<p class="text-sm text-[var(--muted-white)]">No leaderboard data available</p>' :
                    entries.map((item, index) => `
                        <div class="p-4 bg-[rgba(0,224,255,0.1)] rounded-md flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-sm font-medium text-[var(--text-white)] mr-2">${item.rank || index + 1}.</span>
                                <p class="text-sm font-medium text-[var(--text-white)]">${item.username || 'Unknown'} (${item.userHandle || '@unknown'})</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-[var(--muted-white)]">Profit: $${item.profit || 0}</p>
                                <p class="text-xs text-[var(--muted-white)]">Bet: $${item.betAmount || 0} x${item.multiplier || 0}</p>
                            </div>
                        </div>
                    `).join('');
                
                // Notify parent to update sidebar leaderboard count
                if (window.parent && window.parent.document.getElementById('leaderboard-count')) {
                    window.parent.document.getElementById('leaderboard-count').textContent = entries.length || '0';
                    window.parent.document.getElementById('leaderboard-count').classList.toggle('hidden', !entries.length);
                }
            } catch (err) {
                console.error('Error fetching leaderboard:', err);
                document.getElementById('leaderboard-items').innerHTML = 
                    '<p class="text-sm text-[var(--muted-white)]">Error loading leaderboard</p>';
            }
        }

        // Leaderboard form handling
        document.getElementById('open-leaderboard-form').addEventListener('click', () => {
            document.getElementById('leaderboard-modal').classList.remove('hidden');
            document.getElementById('leaderboard-error').classList.add('hidden');
        });

        document.getElementById('leaderboard-cancel').addEventListener('click', () => {
            document.getElementById('leaderboard-modal').classList.add('hidden');
            document.getElementById('leaderboard-error').classList.add('hidden');
            document.getElementById('leaderboard-username').value = '';
            document.getElementById('leaderboard-userHandle').value = '';
            document.getElementById('leaderboard-betAmount').value = '';
            document.getElementById('leaderboard-multiplier').value = '';
            document.getElementById('leaderboard-profit').value = '';
            document.getElementById('leaderboard-period').value = 'daily';
        });

        document.getElementById('leaderboard-submit').addEventListener('click', async () => {
            const username = document.getElementById('leaderboard-username').value.trim();
            const userHandle = document.getElementById('leaderboard-userHandle').value.trim();
            const betAmount = parseFloat(document.getElementById('leaderboard-betAmount').value);
            const multiplier = parseFloat(document.getElementById('leaderboard-multiplier').value);
            const profit = parseFloat(document.getElementById('leaderboard-profit').value);
            const period = document.getElementById('leaderboard-period').value;
            const errorDiv = document.getElementById('leaderboard-error');

            if (!username || !userHandle || isNaN(betAmount) || betAmount < 0 || isNaN(multiplier) || multiplier <= 0 || isNaN(profit) || profit < 0) {
                errorDiv.textContent = 'Please provide valid username, user handle, bet amount, multiplier, and profit';
                errorDiv.classList.remove('hidden');
                return;
            }

            try {
                // Fetch existing entries to calculate rank
                const response = await fetch(`https://symmetrical-chainsaw-otqn.onrender.com/api/leaderboard?period=${period}`);
                const entries = response.ok ? await response.json() : [];
                const rank = entries.length + 1;

                const submitResponse = await fetch('https://symmetrical-chainsaw-otqn.onrender.com/api/leaderboard', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, userHandle, betAmount, multiplier, profit, period, rank })
                });
                const result = await submitResponse.json();
                if (!submitResponse.ok) {
                    throw new Error(result.error || `Leaderboard API failed: ${submitResponse.status}`);
                }
                alert('Leaderboard entry submitted successfully!');
                document.getElementById('leaderboard-modal').classList.add('hidden');
                document.getElementById('leaderboard-username').value = '';
                document.getElementById('leaderboard-userHandle').value = '';
                document.getElementById('leaderboard-betAmount').value = '';
                document.getElementById('leaderboard-multiplier').value = '';
                document.getElementById('leaderboard-profit').value = '';
                document.getElementById('leaderboard-period').value = 'daily';
                fetchLeaderboard(period);
            } catch (err) {
                console.error('Error submitting leaderboard entry:', err);
                errorDiv.textContent = err.message || 'Failed to submit entry';
                errorDiv.classList.remove('hidden');
            }
        });

        // Period toggle
        document.getElementById('period-daily').addEventListener('click', () => {
            fetchLeaderboard('daily');
            document.getElementById('period-daily').classList.add('bg-[rgba(0,224,255,0.2)]', 'text-[var(--accent-cyan)]');
            document.getElementById('period-monthly').classList.remove('bg-[rgba(0,224,255,0.2)]', 'text-[var(--accent-cyan)]');
            document.getElementById('period-monthly').classList.add('text-[var(--muted-white)]');
        });

        document.getElementById('period-monthly').addEventListener('click', () => {
            fetchLeaderboard('monthly');
            document.getElementById('period-monthly').classList.add('bg-[rgba(0,224,255,0.2)]', 'text-[var(--accent-cyan)]');
            document.getElementById('period-daily').classList.remove('bg-[rgba(0,224,255,0.2)]', 'text-[var(--accent-cyan)]');
            document.getElementById('period-daily').classList.add('text-[var(--muted-white)]');
        });

        document.addEventListener('DOMContentLoaded', () => {
            fetchLeaderboard();
        });
    </script>
</body>
</html>