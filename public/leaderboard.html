<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com https://fonts.gstatic.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https://sh4ner.com  https://res.cloudinary.com;
        connect-src 'self' https://sh4ner.com  https://cdn.jsdelivr.net https://kick.com https://bc.game https://t.me https://youtube.com https://www.instagram.com;
        frame-src 'self' https://www.youtube.com https://youtube.com https://youtu.be https://www.youtube-nocookie.com https://player.vimeo.com https://www.kick.com;
        media-src 'self' sound/;
    ">
    <title>SH4NER | SH4NE_R - Leaderboard</title>
    <link rel="preload" href="/font/ACROTERIONJF-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" href="/font/ACROTERIONJF-Regular.woff" as="font" type="font/woff" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=block" rel="stylesheet">
    <link rel="stylesheet" href="/leaderboard.css">
</head>
<body>
    <div class="bg-pattern"></div>

    <header class="header fixed z-50">
        <div class="w-full px-4 sm:px-6 lg:px-8 h-full flex items-center justify-between">
            <div class="flex items-center w-1/3 left-icons">
                <nav class="flex space-x-2 sm:space-x-4">
                    <a href="index.html" class="text-[#dfefff]/95 uppercase font-semibold text-xs sm:text-sm tracking-wide">Home</a>
                    <a href="leaderboard.html" class="text-[#dfefff]/95 uppercase font-semibold text-xs sm:text-sm tracking-wide nav-active">Leaderboard</a>
                    <a href="game.html" class="text-[#dfefff]/95 uppercase font-semibold text-xs sm:text-sm tracking-wide">Live&Wins</a>
                    <a href="givaway.html" class="text-[#dfefff]/95 uppercase font-semibold text-xs sm:text-sm tracking-wide">Giveaways</a>
                        <a href="offers.html" class="text-[#dfefff]/95 uppercase font-semibold text-xs sm:text-sm tracking-wide">Offers</a>
                </nav>
            </div>
            <div class="flex justify-center w-1/3 logo-container">
                <img src="/img/Sh4ner_White 1.png" alt="Logo" class="h-8 sm:h-10 rounded-full object-cover">
            </div>
            <div class="flex items-center space-x-1 sm:space-x-2 w-1/3 justify-end right-icons">
                <a href="https://x.com/sh4ne_r?t=3Uet8-mY59EnhAzmaig5Hw&s=09" target="_blank" aria-label="X" class="feather-icon">
                    <svg class="text-white w-6 h-6 sm:w-8 sm:h-8" viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 5.9199219 6 L 20.582031 27.375 L 6.2304688 44 L 9.4101562 44 L 21.986328 29.421875 L 31.986328 44 L 44 44 L 28.681641 21.669922 L 42.199219 6 L 39.029297 6 L 27.275391 19.617188 L 17.933594 6 L 5.9199219 6 z M 9.7167969 8 L 16.880859 8 L 40.203125 42 L 33.039062 42 L 9.7167969 8 z"></path>
                    </svg>
                </a>
                <span class="icon-fallback">X</span>
                <a href="https://youtube.com/@sh4neryt?si=mW-9I4vw14vgCbC_" target="_blank" aria-label="YouTube" class="feather-icon">
                    <i data-feather="youtube" class="text-white w-6 h-6 sm:w-8 sm:h-8"></i>
                </a>
                <span class="icon-fallback">YT</span>
                <a href="https://www.instagram.com/s4r.clips?igsh=Z3pyM3hua21qNmI5" target="_blank" aria-label="Instagram" class="feather-icon">
                    <i data-feather="instagram" class="text-white w-6 h-6 sm:w-8 sm:h-8"></i>
                </a>
                <span class="icon-fallback">IG</span>
                <a href="https://t.me/SH4NERLOBBY" target="_blank" aria-label="Telegram" class="feather-icon">
                    <i data-feather="send" class="text-white w-6 h-6 sm:w-8 sm:h-8"></i>
                </a>
                <span class="icon-fallback">TG</span>
                <a href="https://kick.com/sh4ne_r" target="_blank" class="cta-button flex items-center uppercase font-bold tracking-wider">
                    Follow on Kick!
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 sm:pt-32 pb-12 sm:pb-16 relative">
        <section class="mb-8 sm:mb-12" aria-labelledby="leaderboard-heading">
            <h2 id="leaderboard-heading" class="social-heading">LEADERBOARD</h2>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Title + Refresh Button -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4">
                    <h3 class="text-2xl sm:text-3xl font-bold text-white">SH4NE_R | WAGER RACE</h3>
             <button id="refresh-btn"
    class="flex items-center gap-2 bg-[#00E0FF] text-black font-semibold py-2.5 px-6 rounded-xl
           shadow-md hover:shadow-xl hover:bg-[#00d2f0] active:scale-95 transition-all duration-200">

    <svg xmlns="http://www.w3.org/2000/svg"
        class="w-5 h-5 transition-transform duration-300 group-hover:rotate-180"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4.5 9a7.5 7.5 0 0112.8-4.8L19 6m0 0V3m0 3h-3
               M19.5 15a7.5 7.5 0 01-12.8 4.8L5 18m0 0v3m0-3h3" />
    </svg>

    <span class="hidden sm:inline">Refresh Leaderboard</span>
</button>


                </div>

                <div class="winner-grid" data-aos="fade-up"></div>
                <div class="countdown-card" data-aos="fade-up">
                    <h4 class="text-lg sm:text-xl font-bold text-[#00E0FF] mb-3 sm:mb-4">Time Remaining</h4>
                    <div class="countdown-grid">
                        <div class="countdown-box">
                            <p id="countdown-days" class="text-xl sm:text-2xl font-bold text-white mb-1"></p>
                            <p class="text-xs sm:text-sm text-gray-400">Days</p>
                        </div>
                        <div class="countdown-box">
                            <p id="countdown-hours" class="text-xl sm:text-2xl font-bold text-white mb-1"></p>
                            <p class="text-xs sm:text-sm text-gray-400">Hours</p>
                        </div>
                        <div class="countdown-box">
                            <p id="countdown-minutes" class="text-xl sm:text-2xl font-bold text-white mb-1"></p>
                            <p class="text-xs sm:text-sm text-gray-400">Minutes</p>
                        </div>
                        <div class="countdown-box">
                            <p id="countdown-seconds" class="text-xl sm:text-2xl font-bold text-white mb-1"></p>
                            <p class="text-xs sm:text-sm text-gray-400">Seconds</p>
                        </div>
                    </div>
                </div>
                <table id="leaderboard" class="w-full mt-4 sm:mt-6 overflow-x-auto">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Username</th>
                            <th>Total Wager ($)</th>
                            <th>Prize ($)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Promo Modal -->
        <div id="promo-modal" class="modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <img src="/img/Poker Chip Shuffle.gif" alt="Poker Chip Shuffle" class="modal-image">
                <p class="text-1xl sm:text-2xl font-bold text-white">Join the SH4NE_R Action! Grab Your Bonus Now!</p>
                <a href="https://bcgame.st/i-sh4ner-n" target="_blank" class="modal-button">Use Code SH4NE</a>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="bottom-nav">
        <a href="index.html"><i data-feather="home"></i>Home</a>
        <a href="leaderboard.html" class="nav-active"><i data-feather="award"></i>Leaderboard</a>
        <a href="game.html"><i data-feather="play-circle"></i>Live&Wins</a>
        <a href="givaway.html"><i data-feather="gift"></i>Giveaways</a>
    </nav>

    <!-- Floating Kick Button (Mobile Only) -->
    <a href="https://kick.com/sh4ne_r" target="_blank" class="floating-kick-button">Follow on Kick!</a>

    <!-- Floating Help Button (Mobile Only) -->


    <!-- Footer Section -->
    <footer class="footer">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="section-divider w-full mb-8"></div>
                <h2 class="text-[#FFFF00] font-bold text-[48px] text-center font-['Poppins']">Disclaimer</h2>
                <p class="text-[16px] text-center font-['Poppins'] font-normal mt-4 max-w-2xl mx-auto disclaimer-text">
                   SH4NE_R (sh4ner.com) is an independent gaming news site and casino comparison service. While we endeavour to ensure that bonus offers listed here are accurate and up-to-date, we accept no responsibility for any inaccuracies or errors. Please check the full terms and conditions before deciding to take any bonus.
                </p>
                <h1 class="text-[#FF0000] font-bold text-[48px] text-center font-['Poppins'] mt-8">Gamble Responsibly</h1>
                <p class="text-[16px] text-center font-['Poppins'] font-normal mt-4 max-w-2xl mx-auto gamble-text">
                  Please gamble responsibly. Gambling can have serious consequences. Only play with money you can afford to lose.
                </p>
                <div class="footer-logo-container">
                    <img src="/img/75a66996c8988a839e73f363914e85fba6db1e10.png" alt="Logo 1" class="footer-logo">
                    <img src="/img/1be4be065fedecbf48f67c6f6b5dc6ffa0b85cfb.png" alt="Logo 2" class="footer-logo">
                    <img src="/img/b787bdceb376f6ca4007ae8c5de2c7bcea17b7ef.png" alt="Logo 3" class="footer-logo">
                    <img src="/img/164ae989bb0b639138196e2074669754ca16ba85.png" alt="Logo 4" class="footer-logo">
                </div>
                <p class="text-[12px] text-center font-['Poppins'] font-normal mt-4">
                    Â© 2024 SH4NE_R. All rights reserved. 
                    <a href="#" class="underline">Privacy Policy</a> | 
                    <a href="#" class="underline">Terms of Service</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                feather.replace();
            } catch (e) {
                console.error('Feather Icons failed to load:', e);
            }
            AOS.init();

            // Username masking - one asterisk block in the middle
            function maskUsername(username) {
                if (!username || username.length <= 4) return username || 'Unknown';
                const len = username.length;
                const showStart = Math.max(2, Math.floor(len * 0.25));
                const showEnd = Math.max(2, Math.floor(len * 0.25));
                const masked = '*'.repeat(Math.max(3, len - showStart - showEnd));
                return username.slice(0, showStart) + masked + username.slice(-showEnd);
            }

            // Fallback data (already masked examples)
            const fallbackLeaderboardData = [
                { rank: 1, username: "Ð–Ð•*****Ð§Ð£", totalWager: 243747.58, reward: 3000, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 2, username: "Ma***ts", totalWager: 205427.81, reward: 2000, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 3, username: "Lb*******yb", totalWager: 97128.16, reward: 1000, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 4, username: "El********cc", totalWager: 94694.31, reward: 500, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 5, username: "St********ac", totalWager: 68815, reward: 250, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 6, username: "Ma*****f5", totalWager: 35404.04, reward: 250, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 7, username: "Ki**_K", totalWager: 13919.21, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 8, username: "Ma*****ay", totalWager: 13235.44, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 9, username: "Re**im", totalWager: 11396.51, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 10, username: "Ng******ri", totalWager: 10468.95, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 11, username: "Ø§Ø¨***Ú©Ù„", totalWager: 9752.73, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 12, username: "Az******ðŸš¬", totalWager: 7833.94, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 13, username: "á˜»á“******ðŸŽ­", totalWager: 6474.33, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 14, username: "Tr******oa", totalWager: 6094.99, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 15, username: "Sa**********te", totalWager: 5830.2, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 16, username: "Bu**********ze", totalWager: 5253.2, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 17, username: "Br***um", totalWager: 4680, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 18, username: "à¤¸à¤¾************ðŸš©", totalWager: 4331.13, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 19, username: "ih*****fe", totalWager: 4240, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" },
                { rank: 20, username: "La*****25", totalWager: 3588.75, reward: 0, img: "/img/bc-game-esports-logo-png_seeklogo-619973.png" }
            ];

            async function loadLeaderboard() {
                const refreshBtn = document.getElementById('refresh-btn');
                const originalBtnHTML = refreshBtn.innerHTML;
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = `
                    <svg class="animate-spin w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
                    </svg>
                    Loading...
                `;

                const winnerGrid = document.querySelector('.winner-grid');
                const tbody = document.querySelector("#leaderboard tbody");
                winnerGrid.innerHTML = "";
                tbody.innerHTML = "";

                let players = [];

                try {
                    const res = await fetch(`/api/leaderboard?cacheBust=${Date.now()}`);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const json = await res.json();
                    players = json.data || [];
                } catch (err) {
                    console.error("Failed to load from API, using fallback:", err);
                    players = fallbackLeaderboardData;
                }

                if (!players.length) {
                    winnerGrid.innerHTML = '<p class="text-center text-sm text-[#c7dfe6]">No leaderboard data available.</p>';
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-[#ff5555] italic py-2 text-sm">No data available</td></tr>';
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = originalBtnHTML;
                    return;
                }

                // Apply masking
                players = players.map(p => ({
                    ...p,
                    displayName: maskUsername(p.username || p.displayName || 'Unknown')
                }));

                const sorted = [...players]
                    .sort((a, b) => (a.rank || Infinity) - (b.rank || Infinity))
                    .map((p, i) => ({ ...p, rank: p.rank || i + 1 }));

                const top3 = sorted.slice(0, 3);
                const tableRows = sorted.slice(3, 20);

                const orderedTop = [top3[1], top3[0], top3[2]].filter(Boolean);

                // Render top 3
                orderedTop.forEach((winner, i) => {
                    const isMiddle = i === 1;
                    const rankText = ['2nd', '1st', '3rd'][i];
                    const card = document.createElement('div');
                    card.className = `winner-card ${isMiddle ? 'middle-card' : ''}`;
                    card.innerHTML = `
                        <p class="winner-rank text-white">${rankText}</p>
                        <img src="${winner.img || '/img/bc-game-esports-logo-png_seeklogo-619973.png'}" alt="Avatar" class="winner-avatar">
                        <h4 class="text-white">${winner.displayName}</h4>
                        <img src="/img/Trophy.gif" alt="Trophy" class="trophy-icon">
                        <p class="winning-amount text-white">$${Number(winner.totalWager || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                        <p class="winner-prize text-white">${winner.reward ? '$' + Number(winner.reward).toLocaleString() : ''}</p>
                    `;
                    winnerGrid.appendChild(card);
                });

                // Render table
                tableRows.forEach((p, i) => {
                    const tr = document.createElement('tr');
                    tr.className = (i + 4) % 2 === 0 ? 'bg-[rgba(3,16,22,0.5)]' : '';
                    tr.innerHTML = `
                        <td>${p.rank}</td>
                        <td class="flex items-center gap-2">
                            ${p.img ? `<img src="${p.img}" class="avatar" alt="Avatar">` : ''}
                            ${p.displayName}
                        </td>
                        <td>$${Number(p.totalWager || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                        <td>${p.reward ? '$' + Number(p.reward).toLocaleString() : ''}</td>
                    `;
                    tbody.appendChild(tr);
                });

                // Countdown (until end of month - adjust as needed)
                const updateCountdown = () => {
                    const now = new Date().getTime();
                    const end = new Date('2025-11-30T23:59:59Z').getTime();
                    const distance = end - now;
                    if (distance < 0) {
                        ['days','hours','minutes','seconds'].forEach(id => document.getElementById('countdown-'+id).textContent = '00');
                        return;
                    }
                    const days = Math.floor(distance / (1000*60*60*24)).toString().padStart(2,'0');
                    const hours = Math.floor((distance % (1000*60*60*24)) / (1000*60*60)).toString().padStart(2,'0');
                    const minutes = Math.floor((distance % (1000*60*60)) / (1000*60)).toString().padStart(2,'0');
                    const seconds = Math.floor((distance % (1000*60)) / 1000).toString().padStart(2,'0');
                    document.getElementById('countdown-days').textContent = days;
                    document.getElementById('countdown-hours').textContent = hours;
                    document.getElementById('countdown-minutes').textContent = minutes;
                    document.getElementById('countdown-seconds').textContent = seconds;
                };
                updateCountdown();
                setInterval(updateCountdown, 1000);

                // Show modal
                document.getElementById('promo-modal').style.display = 'flex';

                // Restore button
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = originalBtnHTML;
            }

            // Manual refresh button
            document.getElementById('refresh-btn').addEventListener('click', loadLeaderboard);

            // Modal close
            const modal = document.getElementById('promo-modal');
            document.querySelector('.close-modal').addEventListener('click', () => modal.style.display = 'none');
            modal.addEventListener('click', e => { if (e.target === modal) modal.style.display = 'none'; });
            document.addEventListener('keydown', e => { if (e.key === 'Escape') modal.style.display = 'none'; });

            // Initial load + auto refresh every 4 minutes
            loadLeaderboard();
            setInterval(loadLeaderboard, 240000);
        });
    </script>
</body>
</html>